<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RGB Color Explorer</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg: #0a0b0f;
  --bg-card: #12131a;
  --border: rgba(255,255,255,0.08);
  --border-hover: rgba(255,255,255,0.15);
  --text: rgba(255,255,255,0.9);
  --text-dim: rgba(255,255,255,0.5);
  --red: #ff3b3b;
  --green: #3bff6f;
  --blue: #3b8bff;
  --font-mono: 'IBM Plex Mono', monospace;
  --font-sans: 'Outfit', sans-serif;
  --radius: 12px;
  --transition: 200ms ease;
}

html { scroll-behavior: smooth; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-sans);
  line-height: 1.6;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 3px; }

/* ── NAV ── */
nav {
  position: sticky;
  top: 0;
  z-index: 100;
  background: rgba(10,11,15,0.85);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  padding: 0 2rem;
}
.nav-inner {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 56px;
}
.nav-brand {
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: 1rem;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.nav-brand .dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; }
.nav-brand .dot-r { background: var(--red); box-shadow: 0 0 8px var(--red); }
.nav-brand .dot-g { background: var(--green); box-shadow: 0 0 8px var(--green); }
.nav-brand .dot-b { background: var(--blue); box-shadow: 0 0 8px var(--blue); }
.nav-links { display: flex; gap: 0.25rem; }
.nav-links a {
  color: var(--text-dim);
  text-decoration: none;
  font-size: 0.82rem;
  font-weight: 500;
  padding: 6px 14px;
  border-radius: 6px;
  transition: color var(--transition), background var(--transition);
}
.nav-links a:hover { color: var(--text); background: rgba(255,255,255,0.06); }

/* ── SECTIONS ── */
section {
  max-width: 1200px;
  margin: 0 auto;
  padding: 4rem 2rem;
}
.section-header {
  margin-bottom: 2rem;
}
.section-header h2 {
  font-family: var(--font-sans);
  font-weight: 700;
  font-size: 1.6rem;
  margin-bottom: 0.35rem;
}
.section-header p {
  color: var(--text-dim);
  font-size: 0.9rem;
}
.card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 1.5rem;
  transition: border-color var(--transition);
}
.card:hover { border-color: var(--border-hover); }

/* ── FEATURE 1: MIXER ── */
#mixer-canvas-wrap {
  position: relative;
  width: 100%;
  aspect-ratio: 16/9;
  max-height: 500px;
  background: #050507;
  border-radius: var(--radius);
  overflow: hidden;
  cursor: crosshair;
  touch-action: none;
  border: 1px solid var(--border);
}
#mixer-canvas {
  width: 100%;
  height: 100%;
  display: block;
}
.mixer-readout {
  position: absolute;
  bottom: 12px;
  right: 12px;
  background: rgba(10,11,15,0.9);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 14px;
  font-family: var(--font-mono);
  font-size: 0.78rem;
  display: flex;
  align-items: center;
  gap: 10px;
  pointer-events: none;
}
.mixer-readout .swatch {
  width: 22px; height: 22px;
  border-radius: 4px;
  border: 1px solid var(--border);
}
.mixer-coord {
  position: absolute;
  top: 12px;
  left: 12px;
  font-family: var(--font-mono);
  font-size: 0.72rem;
  color: var(--text-dim);
  pointer-events: none;
  opacity: 0;
  transition: opacity var(--transition);
}
.mixer-coord.visible { opacity: 1; }
.mixer-controls {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-top: 1rem;
}
.mixer-slider-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.mixer-slider-group label {
  font-family: var(--font-mono);
  font-size: 0.78rem;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
}
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: rgba(255,255,255,0.1);
  outline: none;
  cursor: pointer;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px; height: 18px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.3);
  cursor: grab;
}
input[type="range"].slider-r::-webkit-slider-thumb { background: var(--red); box-shadow: 0 0 10px var(--red); }
input[type="range"].slider-g::-webkit-slider-thumb { background: var(--green); box-shadow: 0 0 10px var(--green); }
input[type="range"].slider-b::-webkit-slider-thumb { background: var(--blue); box-shadow: 0 0 10px var(--blue); }

/* ── FEATURE 2: COLOR WHEEL ── */
.wheel-layout {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 2rem;
  align-items: start;
}
.wheel-canvas-area {
  position: relative;
  width: 320px;
  height: 320px;
  cursor: crosshair;
  touch-action: none;
}
#wheel-canvas {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  display: block;
}
.wheel-cursor {
  position: absolute;
  width: 20px;
  height: 20px;
  border: 2px solid #fff;
  border-radius: 50%;
  box-shadow: 0 0 0 1px rgba(0,0,0,0.4), inset 0 0 0 1px rgba(0,0,0,0.3);
  pointer-events: none;
  transform: translate(-50%, -50%);
  top: 50%;
  left: 75%;
  transition: box-shadow var(--transition);
}
.wheel-sidebar {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.wheel-selected-swatch {
  width: 100%;
  height: 100px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: #3b8bff;
  transition: background-color 100ms ease;
}
.wheel-color-info {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.wheel-info-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-family: var(--font-mono);
  font-size: 0.82rem;
  padding: 6px 10px;
  background: rgba(255,255,255,0.04);
  border-radius: 6px;
}
.wheel-info-label {
  color: var(--text-dim);
  font-size: 0.72rem;
  font-weight: 600;
  letter-spacing: 0.5px;
}
.wheel-info-value {
  font-weight: 500;
}
.wheel-slider-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.wheel-slider-group label {
  font-family: var(--font-mono);
  font-size: 0.78rem;
  font-weight: 600;
  display: flex;
  justify-content: space-between;
}
input[type="range"].slider-wheel-l::-webkit-slider-thumb {
  background: #aaa;
  box-shadow: 0 0 10px rgba(255,255,255,0.3);
}
input[type="range"].slider-wheel-s::-webkit-slider-thumb {
  background: #aaa;
  box-shadow: 0 0 10px rgba(255,255,255,0.3);
}
.wheel-copy-btn {
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-family: var(--font-mono);
  font-size: 0.78rem;
  font-weight: 500;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  transition: all var(--transition);
  text-align: center;
}
.wheel-copy-btn:hover { background: rgba(255,255,255,0.12); color: var(--text); }

/* ── FEATURE 3: COLOR BLINDNESS ── */
.cb-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  align-items: center;
  margin-bottom: 1.5rem;
}
.toggle-switch {
  position: relative;
  width: 48px; height: 26px;
  background: rgba(255,255,255,0.1);
  border-radius: 13px;
  cursor: pointer;
  transition: background var(--transition);
  border: none;
  padding: 0;
}
.toggle-switch.active { background: rgba(59,139,255,0.5); }
.toggle-switch::after {
  content: '';
  position: absolute;
  top: 3px; left: 3px;
  width: 20px; height: 20px;
  border-radius: 50%;
  background: #fff;
  transition: transform var(--transition);
}
.toggle-switch.active::after { transform: translateX(22px); }
.cb-types {
  display: flex;
  flex-wrap: wrap;
  gap: 0.4rem;
}
.cb-btn {
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-family: var(--font-sans);
  font-size: 0.75rem;
  font-weight: 500;
  padding: 5px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: all var(--transition);
}
.cb-btn:hover { border-color: var(--border-hover); color: var(--text); }
.cb-btn.active { background: rgba(59,139,255,0.15); border-color: rgba(59,139,255,0.4); color: var(--text); }
.cb-preview {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-top: 1rem;
}
.cb-preview-panel {
  border-radius: var(--radius);
  padding: 1.5rem;
  border: 1px solid var(--border);
  min-height: 200px;
}
.cb-preview-panel h4 {
  font-size: 0.82rem;
  font-weight: 600;
  margin-bottom: 1rem;
  font-family: var(--font-mono);
}
.cb-sample-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
}
.cb-sample-block {
  aspect-ratio: 1;
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-mono);
  font-size: 0.65rem;
  font-weight: 600;
  transition: all 300ms ease;
}

/* ── FEATURE 4: CONTRAST CHECKER ── */
.contrast-layout {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
}
.contrast-pickers {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.contrast-picker-group {
  display: flex;
  align-items: center;
  gap: 12px;
}
.contrast-picker-group label {
  font-size: 0.85rem;
  font-weight: 500;
  min-width: 100px;
}
.contrast-picker-group input[type="color"] {
  -webkit-appearance: none;
  appearance: none;
  width: 48px; height: 48px;
  border: 2px solid var(--border);
  border-radius: 8px;
  background: transparent;
  cursor: pointer;
  padding: 2px;
}
.contrast-picker-group input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
.contrast-picker-group input[type="color"]::-webkit-color-swatch { border: none; border-radius: 5px; }
.contrast-picker-group .hex-input {
  font-family: var(--font-mono);
  font-size: 0.85rem;
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px 12px;
  border-radius: 6px;
  width: 100px;
}
.swap-btn {
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--border);
  color: var(--text-dim);
  font-family: var(--font-sans);
  font-size: 0.82rem;
  font-weight: 500;
  padding: 8px 18px;
  border-radius: 6px;
  cursor: pointer;
  transition: all var(--transition);
  align-self: flex-start;
}
.swap-btn:hover { background: rgba(255,255,255,0.12); color: var(--text); }
.contrast-result {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.contrast-ratio-display {
  font-family: var(--font-mono);
  font-size: 2.5rem;
  font-weight: 700;
  text-align: center;
  padding: 1rem;
}
.contrast-preview {
  border-radius: var(--radius);
  padding: 1.5rem;
  border: 1px solid var(--border);
  min-height: 120px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: 6px;
}
.contrast-preview .text-normal { font-size: 16px; }
.contrast-preview .text-large { font-size: 24px; font-weight: 700; }
.wcag-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.82rem;
  margin-top: 0.5rem;
}
.wcag-table th, .wcag-table td {
  padding: 10px 14px;
  text-align: center;
  border: 1px solid var(--border);
}
.wcag-table th {
  background: rgba(255,255,255,0.04);
  font-family: var(--font-mono);
  font-weight: 600;
  font-size: 0.78rem;
}
.wcag-pass { color: #3bff6f; font-weight: 600; }
.wcag-fail { color: #ff3b3b; font-weight: 600; }

/* ── RESPONSIVE ── */
@media (max-width: 900px) {
  .mixer-controls { grid-template-columns: 1fr; }
  .contrast-layout { grid-template-columns: 1fr; }
  .cb-preview { grid-template-columns: 1fr; }
  .wheel-layout { grid-template-columns: 1fr; justify-items: center; }
}
@media (max-width: 768px) {
  section { padding: 2.5rem 1rem; }
  .nav-links a { font-size: 0.72rem; padding: 6px 8px; }
  .wheel-canvas-area { width: 260px; height: 260px; }
}
</style>
</head>
<body>

<!-- SVG Filters for Color Blindness -->
<svg style="position:absolute;width:0;height:0;" aria-hidden="true">
  <defs>
    <filter id="cb-protanopia">
      <feColorMatrix type="matrix" values="
        0.567, 0.433, 0.000, 0, 0
        0.558, 0.442, 0.000, 0, 0
        0.000, 0.242, 0.758, 0, 0
        0,     0,     0,     1, 0"/>
    </filter>
    <filter id="cb-deuteranopia">
      <feColorMatrix type="matrix" values="
        0.625, 0.375, 0.000, 0, 0
        0.700, 0.300, 0.000, 0, 0
        0.000, 0.300, 0.700, 0, 0
        0,     0,     0,     1, 0"/>
    </filter>
    <filter id="cb-tritanopia">
      <feColorMatrix type="matrix" values="
        0.950, 0.050, 0.000, 0, 0
        0.000, 0.433, 0.567, 0, 0
        0.000, 0.475, 0.525, 0, 0
        0,     0,     0,     1, 0"/>
    </filter>
    <filter id="cb-protanomaly">
      <feColorMatrix type="matrix" values="
        0.817, 0.183, 0.000, 0, 0
        0.333, 0.667, 0.000, 0, 0
        0.000, 0.125, 0.875, 0, 0
        0,     0,     0,     1, 0"/>
    </filter>
    <filter id="cb-deuteranomaly">
      <feColorMatrix type="matrix" values="
        0.800, 0.200, 0.000, 0, 0
        0.258, 0.742, 0.000, 0, 0
        0.000, 0.142, 0.858, 0, 0
        0,     0,     0,     1, 0"/>
    </filter>
    <filter id="cb-tritanomaly">
      <feColorMatrix type="matrix" values="
        0.967, 0.033, 0.000, 0, 0
        0.000, 0.733, 0.267, 0, 0
        0.000, 0.183, 0.817, 0, 0
        0,     0,     0,     1, 0"/>
    </filter>
    <filter id="cb-achromatopsia">
      <feColorMatrix type="matrix" values="
        0.2126, 0.7152, 0.0722, 0, 0
        0.2126, 0.7152, 0.0722, 0, 0
        0.2126, 0.7152, 0.0722, 0, 0
        0,      0,      0,      1, 0"/>
    </filter>
  </defs>
</svg>

<nav>
  <div class="nav-inner">
    <div class="nav-brand">
      <span class="dot dot-r"></span><span class="dot dot-g"></span><span class="dot dot-b"></span>
      RGB Color Explorer
    </div>
    <div class="nav-links">
      <a href="#mixer">Mixer</a>
      <a href="#palette">Palette</a>
      <a href="#colorblind">Blindness</a>
      <a href="#contrast">Contrast</a>
    </div>
  </div>
</nav>

<!-- ════════════════ FEATURE 1: MIXER ════════════════ -->
<section id="mixer">
  <div class="section-header">
    <h2>Flashlight Color Mixer</h2>
    <p>Drag the RGB lights to explore additive color mixing. Hover over the canvas to sample colors.</p>
  </div>
  <div class="card">
    <div id="mixer-canvas-wrap">
      <canvas id="mixer-canvas"></canvas>
      <div class="mixer-coord" id="mixer-coord">x: 0, y: 0</div>
      <div class="mixer-readout" id="mixer-readout">
        <div class="swatch" id="readout-swatch"></div>
        <span id="readout-text">#000000 &middot; rgb(0, 0, 0)</span>
      </div>
    </div>
    <div class="mixer-controls">
      <div class="mixer-slider-group">
        <label style="color:var(--red)"><span>Red</span><span id="r-val">255</span></label>
        <input type="range" class="slider-r" id="slider-r" min="0" max="255" value="255">
      </div>
      <div class="mixer-slider-group">
        <label style="color:var(--green)"><span>Green</span><span id="g-val">255</span></label>
        <input type="range" class="slider-g" id="slider-g" min="0" max="255" value="255">
      </div>
      <div class="mixer-slider-group">
        <label style="color:var(--blue)"><span>Blue</span><span id="b-val">255</span></label>
        <input type="range" class="slider-b" id="slider-b" min="0" max="255" value="255">
      </div>
    </div>
  </div>
</section>

<!-- ════════════════ FEATURE 2: COLOR WHEEL ════════════════ -->
<section id="palette">
  <div class="section-header">
    <h2>Color Wheel Explorer</h2>
    <p>Click or drag on the wheel to explore the full color spectrum. Adjust lightness with the slider.</p>
  </div>
  <div class="card">
    <div class="wheel-layout">
      <div class="wheel-canvas-area">
        <canvas id="wheel-canvas" width="400" height="400"></canvas>
        <div class="wheel-cursor" id="wheel-cursor"></div>
      </div>
      <div class="wheel-sidebar">
        <div class="wheel-selected-swatch" id="wheel-swatch"></div>
        <div class="wheel-color-info" id="wheel-info">
          <div class="wheel-info-row"><span class="wheel-info-label">HEX</span><span class="wheel-info-value" id="wheel-hex">#3B8BFF</span></div>
          <div class="wheel-info-row"><span class="wheel-info-label">RGB</span><span class="wheel-info-value" id="wheel-rgb">59, 139, 255</span></div>
          <div class="wheel-info-row"><span class="wheel-info-label">HSL</span><span class="wheel-info-value" id="wheel-hsl">216°, 100%, 62%</span></div>
        </div>
        <div class="wheel-slider-group">
          <label>Lightness <span id="wheel-l-val">50%</span></label>
          <input type="range" class="slider-wheel-l" id="wheel-lightness" min="5" max="95" value="50">
        </div>
        <div class="wheel-slider-group">
          <label>Saturation <span id="wheel-s-val">100%</span></label>
          <input type="range" class="slider-wheel-s" id="wheel-saturation" min="0" max="100" value="100">
        </div>
        <button class="swatch-copy wheel-copy-btn" id="wheel-copy-btn" data-hex="#3B8BFF">Copy HEX</button>
      </div>
    </div>
  </div>
</section>

<!-- ════════════════ FEATURE 3: COLOR BLINDNESS ════════════════ -->
<section id="colorblind">
  <div class="section-header">
    <h2>Color Blindness Simulator</h2>
    <p>See how colors appear under different types of color vision deficiency.</p>
  </div>
  <div class="card">
    <div class="cb-controls">
      <label style="display:flex;align-items:center;gap:10px;">
        Simulation
        <button class="toggle-switch" id="cb-toggle" role="switch" aria-checked="false" aria-label="Toggle color blindness simulation"></button>
      </label>
      <div class="cb-types" id="cb-types">
        <button class="cb-btn active" data-type="protanopia">Protanopia</button>
        <button class="cb-btn" data-type="deuteranopia">Deuteranopia</button>
        <button class="cb-btn" data-type="tritanopia">Tritanopia</button>
        <button class="cb-btn" data-type="protanomaly">Protanomaly</button>
        <button class="cb-btn" data-type="deuteranomaly">Deuteranomaly</button>
        <button class="cb-btn" data-type="tritanomaly">Tritanomaly</button>
        <button class="cb-btn" data-type="achromatopsia">Achromatopsia</button>
      </div>
    </div>
    <div class="cb-preview">
      <div class="cb-preview-panel" id="cb-normal">
        <h4>Normal Vision</h4>
        <div class="cb-sample-grid" id="cb-grid-normal"></div>
      </div>
      <div class="cb-preview-panel" id="cb-simulated">
        <h4>Simulated: <span id="cb-type-label">Protanopia</span></h4>
        <div class="cb-sample-grid" id="cb-grid-sim"></div>
      </div>
    </div>
  </div>
</section>

<!-- ════════════════ FEATURE 4: CONTRAST ════════════════ -->
<section id="contrast">
  <div class="section-header">
    <h2>WCAG Contrast Checker</h2>
    <p>Check if your color combinations meet accessibility standards.</p>
  </div>
  <div class="card">
    <div class="contrast-layout">
      <div class="contrast-pickers">
        <div class="contrast-picker-group">
          <label>Text Color</label>
          <input type="color" id="contrast-fg" value="#ffffff">
          <input type="text" class="hex-input" id="contrast-fg-hex" value="#ffffff" maxlength="7" aria-label="Text color hex value">
        </div>
        <div class="contrast-picker-group">
          <label>Background</label>
          <input type="color" id="contrast-bg" value="#0a0b0f">
          <input type="text" class="hex-input" id="contrast-bg-hex" value="#0a0b0f" maxlength="7" aria-label="Background color hex value">
        </div>
        <button class="swap-btn" id="swap-colors-btn">Swap Colors</button>
        <div class="contrast-preview" id="contrast-preview">
          <span class="text-large">Large text sample (24px)</span>
          <span class="text-normal">Normal text sample — The quick brown fox jumps over the lazy dog.</span>
        </div>
      </div>
      <div class="contrast-result">
        <div class="contrast-ratio-display" id="contrast-ratio">21.00 : 1</div>
        <table class="wcag-table">
          <thead>
            <tr><th>Level</th><th>Normal Text</th><th>Large Text</th></tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>AA</strong></td>
              <td id="wcag-aa-normal"></td>
              <td id="wcag-aa-large"></td>
            </tr>
            <tr>
              <td><strong>AAA</strong></td>
              <td id="wcag-aaa-normal"></td>
              <td id="wcag-aaa-large"></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<script>
// ─────────────────────────────────────────────────
//  Utility functions
// ─────────────────────────────────────────────────
function clamp(v, min, max) { return Math.max(min, Math.min(max, v)); }

function hexToRgb(hex) {
  hex = hex.replace('#', '');
  return {
    r: parseInt(hex.substring(0, 2), 16),
    g: parseInt(hex.substring(2, 4), 16),
    b: parseInt(hex.substring(4, 6), 16)
  };
}

function rgbToHex(r, g, b) {
  return '#' + [r, g, b].map(c => clamp(Math.round(c), 0, 255).toString(16).padStart(2, '0')).join('');
}

function rgbToHsl(r, g, b) {
  r /= 255; g /= 255; b /= 255;
  const max = Math.max(r, g, b), min = Math.min(r, g, b);
  let h, s, l = (max + min) / 2;
  if (max === min) {
    h = s = 0;
  } else {
    const d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    switch (max) {
      case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
      case g: h = ((b - r) / d + 2) / 6; break;
      case b: h = ((r - g) / d + 4) / 6; break;
    }
  }
  return { h: h * 360, s, l };
}

function hslToRgb(h, s, l) {
  h = ((h % 360) + 360) % 360;
  h /= 360;
  let r, g, b;
  if (s === 0) {
    r = g = b = l;
  } else {
    const hue2rgb = (p, q, t) => {
      if (t < 0) t += 1;
      if (t > 1) t -= 1;
      if (t < 1/6) return p + (q - p) * 6 * t;
      if (t < 1/2) return q;
      if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
      return p;
    };
    const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
    const p = 2 * l - q;
    r = hue2rgb(p, q, h + 1/3);
    g = hue2rgb(p, q, h);
    b = hue2rgb(p, q, h - 1/3);
  }
  return {
    r: Math.round(r * 255),
    g: Math.round(g * 255),
    b: Math.round(b * 255)
  };
}

// ─────────────────────────────────────────────────
//  FEATURE 1: Flashlight Color Mixer
// ─────────────────────────────────────────────────
(function() {
  const canvas = document.getElementById('mixer-canvas');
  const wrap = document.getElementById('mixer-canvas-wrap');
  const ctx = canvas.getContext('2d');
  const coord = document.getElementById('mixer-coord');
  const readoutSwatch = document.getElementById('readout-swatch');
  const readoutText = document.getElementById('readout-text');
  const sliderR = document.getElementById('slider-r');
  const sliderG = document.getElementById('slider-g');
  const sliderB = document.getElementById('slider-b');
  const rVal = document.getElementById('r-val');
  const gVal = document.getElementById('g-val');
  const bVal = document.getElementById('b-val');

  const LIGHT_RADIUS_RATIO = 0.22;
  let W, H, lightRadius;

  const lights = [
    { x: 0.35, y: 0.4, color: [255, 0, 0], label: 'R', dragging: false },
    { x: 0.5, y: 0.6, color: [0, 255, 0], label: 'G', dragging: false },
    { x: 0.65, y: 0.4, color: [0, 0, 255], label: 'B', dragging: false }
  ];

  let hoveredColor = { r: 0, g: 0, b: 0 };
  let lastSampledColor = null;

  function resize() {
    const rect = wrap.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    W = rect.width;
    H = rect.height;
    canvas.width = W * dpr;
    canvas.height = H * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    lightRadius = Math.min(W, H) * LIGHT_RADIUS_RATIO;
    draw();
  }

  function draw() {
    ctx.clearRect(0, 0, W, H);
    ctx.fillStyle = '#050507';
    ctx.fillRect(0, 0, W, H);
    ctx.globalCompositeOperation = 'screen';

    const intensities = [
      sliderR.value / 255,
      sliderG.value / 255,
      sliderB.value / 255
    ];

    lights.forEach((light, i) => {
      const cx = light.x * W;
      const cy = light.y * H;
      const intensity = intensities[i];
      const r = lightRadius;

      const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, r);
      const [cr, cg, cb] = light.color;
      grad.addColorStop(0, `rgba(${Math.round(cr * intensity)},${Math.round(cg * intensity)},${Math.round(cb * intensity)},1)`);
      grad.addColorStop(0.4, `rgba(${Math.round(cr * intensity)},${Math.round(cg * intensity)},${Math.round(cb * intensity)},0.6)`);
      grad.addColorStop(1, `rgba(${Math.round(cr * intensity)},${Math.round(cg * intensity)},${Math.round(cb * intensity)},0)`);

      ctx.fillStyle = grad;
      ctx.beginPath();
      ctx.arc(cx, cy, r, 0, Math.PI * 2);
      ctx.fill();
    });

    ctx.globalCompositeOperation = 'source-over';

    // Draw labels
    lights.forEach((light) => {
      const cx = light.x * W;
      const cy = light.y * H;
      ctx.fillStyle = 'rgba(255,255,255,0.6)';
      ctx.font = '600 13px "IBM Plex Mono", monospace';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(light.label, cx, cy);
    });
  }

  function sampleColor(mx, my) {
    const dpr = window.devicePixelRatio || 1;
    const pixel = ctx.getImageData(mx * dpr, my * dpr, 1, 1).data;
    return { r: pixel[0], g: pixel[1], b: pixel[2] };
  }

  function updateReadout(mx, my) {
    const c = sampleColor(mx, my);
    hoveredColor = c;
    const hex = rgbToHex(c.r, c.g, c.b);
    readoutSwatch.style.background = hex;
    readoutText.textContent = `${hex} · rgb(${c.r}, ${c.g}, ${c.b})`;
    lastSampledColor = hex;
  }

  function getPointerPos(e) {
    const rect = wrap.getBoundingClientRect();
    const touch = e.touches ? e.touches[0] : e;
    return {
      x: touch.clientX - rect.left,
      y: touch.clientY - rect.top
    };
  }

  function findLight(mx, my) {
    for (let i = lights.length - 1; i >= 0; i--) {
      const lx = lights[i].x * W;
      const ly = lights[i].y * H;
      const dist = Math.hypot(mx - lx, my - ly);
      if (dist < lightRadius * 0.6) return i;
    }
    return -1;
  }

  let activeDrag = -1;
  let dragOffset = { x: 0, y: 0 };

  function onPointerDown(e) {
    const pos = getPointerPos(e);
    const idx = findLight(pos.x, pos.y);
    if (idx >= 0) {
      activeDrag = idx;
      dragOffset.x = pos.x - lights[idx].x * W;
      dragOffset.y = pos.y - lights[idx].y * H;
      coord.classList.add('visible');
      e.preventDefault();
    }
  }

  function onPointerMove(e) {
    const pos = getPointerPos(e);
    if (activeDrag >= 0) {
      lights[activeDrag].x = clamp((pos.x - dragOffset.x) / W, 0.05, 0.95);
      lights[activeDrag].y = clamp((pos.y - dragOffset.y) / H, 0.05, 0.95);
      coord.textContent = `x: ${Math.round(lights[activeDrag].x * W)}, y: ${Math.round(lights[activeDrag].y * H)}`;
      draw();
      updateReadout(pos.x, pos.y);
      e.preventDefault();
    } else {
      updateReadout(pos.x, pos.y);
    }
  }

  function onPointerUp() {
    activeDrag = -1;
    coord.classList.remove('visible');
  }

  wrap.addEventListener('mousedown', onPointerDown);
  wrap.addEventListener('mousemove', onPointerMove);
  window.addEventListener('mouseup', onPointerUp);
  wrap.addEventListener('touchstart', onPointerDown, { passive: false });
  wrap.addEventListener('touchmove', onPointerMove, { passive: false });
  window.addEventListener('touchend', onPointerUp);

  [sliderR, sliderG, sliderB].forEach((s, i) => {
    s.addEventListener('input', () => {
      [rVal, gVal, bVal][i].textContent = s.value;
      draw();
    });
  });

  window.addEventListener('resize', resize);
  resize();

  // Expose for palette sampling
  window.mixerGetLastColor = () => lastSampledColor || '#000000';
})();

// ─────────────────────────────────────────────────
//  FEATURE 2: Color Wheel Explorer
// ─────────────────────────────────────────────────
(function() {
  const canvas = document.getElementById('wheel-canvas');
  const ctx = canvas.getContext('2d');
  const cursor = document.getElementById('wheel-cursor');
  const swatch = document.getElementById('wheel-swatch');
  const hexEl = document.getElementById('wheel-hex');
  const rgbEl = document.getElementById('wheel-rgb');
  const hslEl = document.getElementById('wheel-hsl');
  const lSlider = document.getElementById('wheel-lightness');
  const sSlider = document.getElementById('wheel-saturation');
  const lVal = document.getElementById('wheel-l-val');
  const sVal = document.getElementById('wheel-s-val');
  const copyBtn = document.getElementById('wheel-copy-btn');

  let selectedHue = 216;
  let selectedSat = 100;
  let selectedLight = 50;
  let dragging = false;

  function drawWheel() {
    const rect = canvas.getBoundingClientRect();
    const size = rect.width;
    const dpr = window.devicePixelRatio || 1;
    canvas.width = size * dpr;
    canvas.height = size * dpr;
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

    const cx = size / 2;
    const cy = size / 2;
    const outerR = size / 2 - 4;
    const sat = parseInt(sSlider.value) / 100;
    const light = parseInt(lSlider.value) / 100;

    // Draw wheel pixel by pixel using imageData for performance
    const imgData = ctx.createImageData(canvas.width, canvas.height);
    const data = imgData.data;

    for (let py = 0; py < canvas.height; py++) {
      for (let px = 0; px < canvas.width; px++) {
        const x = px / dpr - cx;
        const y = py / dpr - cy;
        const dist = Math.sqrt(x * x + y * y);

        if (dist <= outerR) {
          // Hue from angle
          let angle = Math.atan2(y, x) * (180 / Math.PI);
          if (angle < 0) angle += 360;

          // Saturation from distance (center = 0, edge = slider value)
          const distRatio = dist / outerR;
          const s = distRatio * sat;

          const rgb = hslToRgb(angle, s, light);
          const idx = (py * canvas.width + px) * 4;
          data[idx] = rgb.r;
          data[idx + 1] = rgb.g;
          data[idx + 2] = rgb.b;
          data[idx + 3] = 255;
        }
      }
    }

    ctx.putImageData(imgData, 0, 0);

    // Draw subtle border ring
    ctx.beginPath();
    ctx.arc(cx * dpr, cy * dpr, outerR * dpr, 0, Math.PI * 2);
    ctx.strokeStyle = 'rgba(255,255,255,0.12)';
    ctx.lineWidth = 1 * dpr;
    ctx.stroke();
  }

  function updateFromWheel(mx, my) {
    const rect = canvas.getBoundingClientRect();
    const size = rect.width;
    const cx = size / 2;
    const cy = size / 2;
    const outerR = size / 2 - 4;

    const x = mx - cx;
    const y = my - cy;
    const dist = Math.sqrt(x * x + y * y);

    if (dist > outerR) return;

    let angle = Math.atan2(y, x) * (180 / Math.PI);
    if (angle < 0) angle += 360;

    const sat = parseInt(sSlider.value);
    const distRatio = Math.min(dist / outerR, 1);

    selectedHue = angle;
    selectedSat = distRatio * sat;
    selectedLight = parseInt(lSlider.value);

    updateCursor(mx + rect.left, my + rect.top);
    updateInfo();
  }

  function updateCursor(pageX, pageY) {
    const area = canvas.parentElement.getBoundingClientRect();
    const left = pageX - area.left;
    const top = pageY - area.top;
    cursor.style.left = left + 'px';
    cursor.style.top = top + 'px';
  }

  function positionCursorFromHSL() {
    const rect = canvas.getBoundingClientRect();
    const size = rect.width;
    const cx = size / 2;
    const outerR = size / 2 - 4;

    const sat = parseInt(sSlider.value) || 1;
    const distRatio = selectedSat / sat;
    const dist = Math.min(distRatio, 1) * outerR;
    const rad = selectedHue * (Math.PI / 180);

    const px = cx + dist * Math.cos(rad);
    const py = cx + dist * Math.sin(rad);

    cursor.style.left = px + 'px';
    cursor.style.top = py + 'px';
  }

  function updateInfo() {
    const rgb = hslToRgb(selectedHue, selectedSat / 100, selectedLight / 100);
    const hex = rgbToHex(rgb.r, rgb.g, rgb.b);

    swatch.style.background = hex;
    hexEl.textContent = hex.toUpperCase();
    rgbEl.textContent = `${rgb.r}, ${rgb.g}, ${rgb.b}`;
    hslEl.textContent = `${Math.round(selectedHue)}°, ${Math.round(selectedSat)}%, ${selectedLight}%`;
    copyBtn.dataset.hex = hex.toUpperCase();
  }

  function getPointerPos(e) {
    const rect = canvas.getBoundingClientRect();
    const touch = e.touches ? e.touches[0] : e;
    return { x: touch.clientX - rect.left, y: touch.clientY - rect.top };
  }

  canvas.addEventListener('mousedown', (e) => {
    dragging = true;
    const pos = getPointerPos(e);
    updateFromWheel(pos.x, pos.y);
  });
  window.addEventListener('mousemove', (e) => {
    if (!dragging) return;
    const pos = getPointerPos(e);
    updateFromWheel(pos.x, pos.y);
  });
  window.addEventListener('mouseup', () => { dragging = false; });

  canvas.addEventListener('touchstart', (e) => {
    dragging = true;
    const pos = getPointerPos(e);
    updateFromWheel(pos.x, pos.y);
    e.preventDefault();
  }, { passive: false });
  window.addEventListener('touchmove', (e) => {
    if (!dragging) return;
    const pos = getPointerPos(e);
    updateFromWheel(pos.x, pos.y);
  });
  window.addEventListener('touchend', () => { dragging = false; });

  lSlider.addEventListener('input', () => {
    selectedLight = parseInt(lSlider.value);
    lVal.textContent = selectedLight + '%';
    drawWheel();
    updateInfo();
  });

  sSlider.addEventListener('input', () => {
    const v = parseInt(sSlider.value);
    sVal.textContent = v + '%';
    drawWheel();
    positionCursorFromHSL();
    updateInfo();
  });

  copyBtn.addEventListener('click', () => {
    navigator.clipboard.writeText(copyBtn.dataset.hex).then(() => {
      copyBtn.textContent = 'Copied!';
      setTimeout(() => { copyBtn.textContent = 'Copy HEX'; }, 1200);
    });
  });

  function init() {
    drawWheel();
    positionCursorFromHSL();
    updateInfo();
  }

  window.addEventListener('resize', () => {
    drawWheel();
    positionCursorFromHSL();
  });

  init();
})();

// ─────────────────────────────────────────────────
//  FEATURE 3: Color Blindness Simulator
// ─────────────────────────────────────────────────
(function() {
  const toggle = document.getElementById('cb-toggle');
  const typesWrap = document.getElementById('cb-types');
  const typeLabel = document.getElementById('cb-type-label');
  const gridNormal = document.getElementById('cb-grid-normal');
  const gridSim = document.getElementById('cb-grid-sim');
  const simPanel = document.getElementById('cb-simulated');
  let active = false;
  let currentType = 'protanopia';

  const sampleColors = [
    { hex: '#ff3b3b', label: 'Red' },
    { hex: '#ff9f0a', label: 'Orange' },
    { hex: '#ffd60a', label: 'Yellow' },
    { hex: '#3bff6f', label: 'Green' },
    { hex: '#30d5c8', label: 'Teal' },
    { hex: '#3b8bff', label: 'Blue' },
    { hex: '#bf5af2', label: 'Purple' },
    { hex: '#ff375f', label: 'Pink' },
    { hex: '#ffffff', label: 'White' },
    { hex: '#8e8e93', label: 'Gray' },
    { hex: '#48484a', label: 'DkGray' },
    { hex: '#1c1c1e', label: 'Black' }
  ];

  // Color blindness transformation matrices
  const cbMatrices = {
    protanopia:    [0.567,0.433,0, 0.558,0.442,0, 0,0.242,0.758],
    deuteranopia:  [0.625,0.375,0, 0.700,0.300,0, 0,0.300,0.700],
    tritanopia:    [0.950,0.050,0, 0,0.433,0.567, 0,0.475,0.525],
    protanomaly:   [0.817,0.183,0, 0.333,0.667,0, 0,0.125,0.875],
    deuteranomaly: [0.800,0.200,0, 0.258,0.742,0, 0,0.142,0.858],
    tritanomaly:   [0.967,0.033,0, 0,0.733,0.267, 0,0.183,0.817],
    achromatopsia: [0.2126,0.7152,0.0722, 0.2126,0.7152,0.0722, 0.2126,0.7152,0.0722]
  };

  function applyMatrix(r, g, b, m) {
    return {
      r: clamp(Math.round(m[0]*r + m[1]*g + m[2]*b), 0, 255),
      g: clamp(Math.round(m[3]*r + m[4]*g + m[5]*b), 0, 255),
      b: clamp(Math.round(m[6]*r + m[7]*g + m[8]*b), 0, 255)
    };
  }

  function buildGrid(container, filtered) {
    container.innerHTML = '';
    sampleColors.forEach((c) => {
      let bg, textColor;
      if (filtered) {
        const rgb = hexToRgb(c.hex);
        const transformed = applyMatrix(rgb.r, rgb.g, rgb.b, cbMatrices[currentType]);
        bg = rgbToHex(transformed.r, transformed.g, transformed.b);
      } else {
        bg = c.hex;
      }
      const lum = relativeLuminance(hexToRgb(bg));
      textColor = lum > 0.179 ? '#000' : '#fff';
      const block = document.createElement('div');
      block.className = 'cb-sample-block';
      block.style.background = bg;
      block.style.color = textColor;
      block.textContent = c.label;
      container.appendChild(block);
    });
  }

  function update() {
    typeLabel.textContent = currentType.charAt(0).toUpperCase() + currentType.slice(1);
    buildGrid(gridNormal, false);
    buildGrid(gridSim, active);
    if (active) {
      simPanel.style.filter = '';
    }
  }

  toggle.addEventListener('click', () => {
    active = !active;
    toggle.classList.toggle('active', active);
    toggle.setAttribute('aria-checked', active);
    update();
  });

  typesWrap.addEventListener('click', (e) => {
    const btn = e.target.closest('[data-type]');
    if (!btn) return;
    typesWrap.querySelectorAll('.cb-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentType = btn.dataset.type;
    update();
  });

  update();
})();

// ─────────────────────────────────────────────────
//  FEATURE 4: WCAG Contrast Checker
// ─────────────────────────────────────────────────
(function() {
  const fgPicker = document.getElementById('contrast-fg');
  const bgPicker = document.getElementById('contrast-bg');
  const fgHex = document.getElementById('contrast-fg-hex');
  const bgHex = document.getElementById('contrast-bg-hex');
  const swapBtn = document.getElementById('swap-colors-btn');
  const preview = document.getElementById('contrast-preview');
  const ratioDisplay = document.getElementById('contrast-ratio');
  const aaNormal = document.getElementById('wcag-aa-normal');
  const aaLarge = document.getElementById('wcag-aa-large');
  const aaaNormal = document.getElementById('wcag-aaa-normal');
  const aaaLarge = document.getElementById('wcag-aaa-large');

  function update() {
    const fg = fgPicker.value;
    const bg = bgPicker.value;

    fgHex.value = fg;
    bgHex.value = bg;

    preview.style.backgroundColor = bg;
    preview.style.color = fg;

    const fgRgb = hexToRgb(fg);
    const bgRgb = hexToRgb(bg);
    const fgLum = relativeLuminance(fgRgb);
    const bgLum = relativeLuminance(bgRgb);
    const lighter = Math.max(fgLum, bgLum);
    const darker = Math.min(fgLum, bgLum);
    const ratio = (lighter + 0.05) / (darker + 0.05);

    ratioDisplay.textContent = `${ratio.toFixed(2)} : 1`;

    const pass = (val, threshold) => val >= threshold;
    const mark = (el, passes) => {
      el.innerHTML = passes
        ? '<span class="wcag-pass">&#10003; PASS</span>'
        : '<span class="wcag-fail">&#10007; FAIL</span>';
    };

    mark(aaNormal, pass(ratio, 4.5));
    mark(aaLarge, pass(ratio, 3));
    mark(aaaNormal, pass(ratio, 7));
    mark(aaaLarge, pass(ratio, 4.5));
  }

  fgPicker.addEventListener('input', update);
  bgPicker.addEventListener('input', update);

  fgHex.addEventListener('input', () => {
    if (/^#[0-9a-fA-F]{6}$/.test(fgHex.value)) {
      fgPicker.value = fgHex.value;
      update();
    }
  });
  bgHex.addEventListener('input', () => {
    if (/^#[0-9a-fA-F]{6}$/.test(bgHex.value)) {
      bgPicker.value = bgHex.value;
      update();
    }
  });

  swapBtn.addEventListener('click', () => {
    const tmp = fgPicker.value;
    fgPicker.value = bgPicker.value;
    bgPicker.value = tmp;
    update();
  });

  update();
})();

// ─────────────────────────────────────────────────
//  Shared: WCAG Relative Luminance (precise sRGB)
// ─────────────────────────────────────────────────
function relativeLuminance({ r, g, b }) {
  const toLinear = (c) => {
    c = c / 255;
    return c <= 0.04045 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
  };
  return 0.2126 * toLinear(r) + 0.7152 * toLinear(g) + 0.0722 * toLinear(b);
}
</script>
</body>
</html>
